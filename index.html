<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#0f172a">
    <title>NutriSync Pro | Health Ecosystem</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        * { font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        
        body {
            background: #0f172a;
            color: white;
            overflow-x: hidden;
        }
        
        .glass {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .glass-strong {
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(30px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .gradient-text {
            background: linear-gradient(135deg, #06b6d4, #3b82f6, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .neon-border {
            box-shadow: 0 0 20px rgba(6, 182, 212, 0.3), inset 0 0 20px rgba(6, 182, 212, 0.1);
        }
        
        .page {
            display: none;
            animation: fadeIn 0.3s ease;
            min-height: 100vh;
            padding-bottom: 100px;
        }
        
        .page.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateX(20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }
        
        .metric-card {
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.8), rgba(15, 23, 42, 0.9));
            border: 1px solid rgba(6, 182, 212, 0.2);
            transition: all 0.3s;
        }
        
        .metric-card:hover {
            transform: translateY(-2px);
            border-color: rgba(6, 182, 212, 0.5);
        }
        
        .pro-toast {
            transform: translateY(-100px);
            transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        
        .pro-toast.show {
            transform: translateY(0);
        }
        
        .world-first-badge {
            background: linear-gradient(90deg, #f59e0b, #d97706);
            box-shadow: 0 0 20px rgba(245, 158, 11, 0.4);
        }
        
        .nav-item {
            transition: all 0.3s;
        }
        
        .nav-item.active {
            color: #06b6d4;
        }
        
        .chat-message {
            max-width: 80%;
            margin: 8px 0;
            padding: 12px 16px;
            border-radius: 20px;
            word-wrap: break-word;
        }
        
        .chat-user {
            background: linear-gradient(135deg, #06b6d4, #3b82f6);
            margin-left: auto;
            border-bottom-right-radius: 4px;
        }
        
        .chat-ai {
            background: rgba(30, 41, 59, 0.9);
            border: 1px solid rgba(139, 92, 246, 0.3);
            margin-right: auto;
            border-bottom-left-radius: 4px;
        }
        
        /* Feature Specific Styles */
        .dna-helix {
            width: 60px;
            height: 60px;
            border: 3px solid #06b6d4;
            border-radius: 50%;
            position: relative;
            animation: rotate 3s linear infinite;
        }
        
        .dna-helix::before {
            content: '';
            position: absolute;
            inset: -3px;
            border: 3px solid transparent;
            border-top-color: #8b5cf6;
            border-radius: 50%;
            animation: rotate 2s linear infinite reverse;
        }
        
        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .vr-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            perspective: 1000px;
        }
        
        .vr-card {
            aspect-ratio: 1;
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.3), rgba(59, 130, 246, 0.3));
            border: 1px solid rgba(139, 92, 246, 0.5);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            transform-style: preserve-3d;
            transition: transform 0.3s;
        }
        
        .vr-card:hover {
            transform: translateZ(20px);
        }
        
        .hrv-graph {
            height: 100px;
            background: linear-gradient(90deg, rgba(6, 182, 212, 0.1), rgba(139, 92, 246, 0.1));
            border-radius: 12px;
            position: relative;
            overflow: hidden;
        }
        
        .hrv-line {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 60%;
            background: linear-gradient(90deg, #06b6d4, #8b5cf6);
            opacity: 0.6;
            animation: hrvPulse 2s ease-in-out infinite;
        }
        
        @keyframes hrvPulse {
            0%, 100% { transform: scaleY(1); }
            50% { transform: scaleY(1.1); }
        }
        
        .gut-bacteria {
            width: 20px;
            height: 20px;
            background: #10b981;
            border-radius: 50%;
            position: absolute;
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translate(0, 0); }
            25% { transform: translate(10px, -10px); }
            50% { transform: translate(0, -20px); }
            75% { transform: translate(-10px, -10px); }
        }
        
        .locked {
            opacity: 0.5;
            filter: grayscale(1);
            pointer-events: none;
        }
        
        .unlocked {
            opacity: 1;
            filter: none;
            pointer-events: all;
        }
    </style>
</head>
<body>
    <!-- Access Overlay -->
    <div id="accessOverlay" class="fixed inset-0 z-[60] glass-strong flex items-center justify-center p-6">
        <div class="text-center max-w-md w-full">
            <div class="w-24 h-24 mx-auto mb-6 rounded-3xl bg-gradient-to-br from-cyan-400 to-blue-600 flex items-center justify-center text-4xl font-bold shadow-2xl shadow-cyan-500/50 animate-pulse">
                <i class="fas fa-dna text-white"></i>
            </div>
            <h1 class="text-4xl font-bold mb-2 tracking-tight">NutriSync<span class="gradient-text"> Pro</span></h1>
            <p class="text-gray-400 mb-8 text-lg">Next-Generation Health Ecosystem</p>
            
            <div class="space-y-4">
                <input type="text" id="accessCodeInput" placeholder="Enter access credentials..." 
                    class="w-full px-6 py-4 rounded-xl bg-gray-800/50 border border-gray-700 text-center text-lg tracking-wider focus:border-cyan-500 focus:outline-none transition"
                    autocomplete="off" autocapitalize="off">
                <div id="accessError" class="text-red-400 text-sm hidden">Invalid credentials</div>
                <button onclick="validateAccess()" class="w-full py-4 rounded-xl bg-gradient-to-r from-cyan-500 to-blue-600 text-white font-bold shadow-lg shadow-cyan-500/25 hover:shadow-cyan-500/40 transition">
                    <i class="fas fa-lock-open mr-2"></i>Unlock Premium
                </button>
                <button onclick="continueLimited()" class="w-full py-4 rounded-xl border border-gray-600 text-gray-400 hover:bg-gray-800 transition">
                    Continue with Limited Access
                </button>
            </div>
        </div>
    </div>

    <!-- Pro Toast -->
    <div id="proToast" class="fixed top-4 left-1/2 transform -translate-x-1/2 z-50 bg-gradient-to-r from-cyan-500 to-blue-600 text-white px-6 py-3 rounded-full font-bold shadow-2xl pro-toast pointer-events-none">
        <i class="fas fa-crown mr-2"></i> Pro Suite Activated - 174+ Features Unlocked
    </div>

    <!-- MAIN APP CONTAINER -->
    <div id="app" class="max-w-lg mx-auto">
        
        <!-- HEADER -->
        <header class="fixed top-0 w-full max-w-lg z-40 glass-strong border-b border-gray-800">
            <div class="px-4 py-4 flex items-center justify-between">
                <button id="backBtn" onclick="goBack()" class="hidden w-10 h-10 rounded-full bg-gray-800 flex items-center justify-center hover:bg-gray-700 transition">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <div class="flex-1">
                    <h1 class="text-xl font-bold" id="pageTitle">Command Center</h1>
                    <p class="text-xs text-gray-400" id="pageSubtitle">Your health ecosystem</p>
                </div>
                <div class="flex items-center gap-2">
                    <div id="proBadge" class="hidden bg-gradient-to-r from-cyan-500 to-blue-600 text-white text-xs px-3 py-1 rounded-full font-bold animate-pulse">
                        <i class="fas fa-crown mr-1"></i> PRO
                    </div>
                </div>
            </div>
        </header>

        <!-- SPACER -->
        <div class="h-20"></div>

        <!-- HOME PAGE -->
        <div id="homePage" class="page active px-4">
            <!-- Stats -->
            <div class="grid grid-cols-2 gap-3 mb-6">
                <div class="metric-card rounded-2xl p-4" onclick="showFeature('profile')">
                    <div class="text-gray-400 text-xs mb-1">WEIGHT</div>
                    <div class="text-2xl font-bold" id="displayWeight">--</div>
                </div>
                <div class="metric-card rounded-2xl p-4" onclick="showFeature('profile')">
                    <div class="text-gray-400 text-xs mb-1">GOAL</div>
                    <div class="text-2xl font-bold" id="displayGoalWeight">--</div>
                </div>
                <div class="metric-card rounded-2xl p-4">
                    <div class="text-gray-400 text-xs mb-1">BMI</div>
                    <div class="text-2xl font-bold" id="displayBMI">--</div>
                </div>
                <div class="metric-card rounded-2xl p-4">
                    <div class="text-gray-400 text-xs mb-1">CALORIES</div>
                    <div class="text-2xl font-bold" id="displayCalories">0</div>
                </div>
            </div>

            <!-- Chart -->
            <div class="glass rounded-2xl p-4 mb-6">
                <h3 class="font-bold mb-4">Weight Trajectory</h3>
                <canvas id="weightChart" height="150"></canvas>
            </div>

            <!-- AI Doctor Card -->
            <div class="glass rounded-2xl p-5 mb-4 cursor-pointer" onclick="showFeature('aiDoctor')">
                <div class="flex items-center gap-4">
                    <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-purple-500 to-pink-600 flex items-center justify-center">
                        <i class="fas fa-user-md text-white text-2xl"></i>
                    </div>
                    <div>
                        <h3 class="font-bold text-lg">AI Doctor</h3>
                        <p class="text-sm text-gray-400">24/7 Medical Intelligence</p>
                    </div>
                    <i class="fas fa-chevron-right ml-auto text-gray-500"></i>
                </div>
            </div>

            <!-- PRO FEATURES GRID -->
            <div class="mb-4">
                <div class="flex items-center justify-between mb-3">
                    <h3 class="font-bold text-lg">Pro Suite <span class="world-first-badge text-xs px-2 py-1 rounded ml-2">174+ FEATURES</span></h3>
                </div>
                
                <div id="proFeaturesGrid" class="feature-grid locked">
                    <!-- DNA Analysis -->
                    <div onclick="showFeature('dna')" class="glass rounded-xl p-4 cursor-pointer hover:border-yellow-500/50 border border-transparent transition">
                        <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-yellow-400 to-orange-600 flex items-center justify-center mb-3">
                            <i class="fas fa-dna text-white"></i>
                        </div>
                        <div class="font-bold text-sm">DNA Analysis</div>
                        <div class="text-xs text-gray-500 mt-1">Genetic nutrition</div>
                    </div>

                    <!-- VR Training -->
                    <div onclick="showFeature('vr')" class="glass rounded-xl p-4 cursor-pointer hover:border-purple-500/50 border border-transparent transition">
                        <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-purple-500 to-pink-600 flex items-center justify-center mb-3">
                            <i class="fas fa-vr-cardboard text-white"></i>
                        </div>
                        <div class="font-bold text-sm">VR Training</div>
                        <div class="text-xs text-gray-500 mt-1">Immersive fitness</div>
                    </div>

                    <!-- Family Network -->
                    <div onclick="showFeature('family')" class="glass rounded-xl p-4 cursor-pointer hover:border-blue-500/50 border border-transparent transition">
                        <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-blue-400 to-indigo-600 flex items-center justify-center mb-3">
                            <i class="fas fa-users text-white"></i>
                        </div>
                        <div class="font-bold text-sm">Family Network</div>
                        <div class="text-xs text-gray-500 mt-1">Group tracking</div>
                    </div>

                    <!-- AI Coach -->
                    <div onclick="showFeature('coach')" class="glass rounded-xl p-4 cursor-pointer hover:border-green-500/50 border border-transparent transition">
                        <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-green-400 to-emerald-600 flex items-center justify-center mb-3">
                            <i class="fas fa-robot text-white"></i>
                        </div>
                        <div class="font-bold text-sm">AI Coach</div>
                        <div class="text-xs text-gray-500 mt-1">Form correction</div>
                    </div>

                    <!-- Clinical Reports -->
                    <div onclick="showFeature('reports')" class="glass rounded-xl p-4 cursor-pointer hover:border-red-500/50 border border-transparent transition">
                        <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-red-400 to-rose-600 flex items-center justify-center mb-3">
                            <i class="fas fa-file-medical text-white"></i>
                        </div>
                        <div class="font-bold text-sm">Clinical Reports</div>
                        <div class="text-xs text-gray-500 mt-1">Medical PDFs</div>
                    </div>

                    <!-- HRV Monitor -->
                    <div onclick="showFeature('hrv')" class="glass rounded-xl p-4 cursor-pointer hover:border-pink-500/50 border border-transparent transition">
                        <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-pink-400 to-rose-600 flex items-center justify-center mb-3">
                            <i class="fas fa-heartbeat text-white"></i>
                        </div>
                        <div class="font-bold text-sm">HRV Monitor</div>
                        <div class="text-xs text-gray-500 mt-1">Stress tracking</div>
                    </div>

                    <!-- Gut Biome -->
                    <div onclick="showFeature('gut')" class="glass rounded-xl p-4 cursor-pointer hover:border-cyan-500/50 border border-transparent transition">
                        <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-cyan-400 to-teal-600 flex items-center justify-center mb-3">
                            <i class="fas fa-bacteria text-white"></i>
                        </div>
                        <div class="font-bold text-sm">Gut Biome</div>
                        <div class="text-xs text-gray-500 mt-1">Microbiome AI</div>
                    </div>

                    <!-- Neurofeedback -->
                    <div onclick="showFeature('neuro')" class="glass rounded-xl p-4 cursor-pointer hover:border-indigo-500/50 border border-transparent transition">
                        <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-indigo-400 to-purple-600 flex items-center justify-center mb-3">
                            <i class="fas fa-brain text-white"></i>
                        </div>
                        <div class="font-bold text-sm">Neurofeedback</div>
                        <div class="text-xs text-gray-500 mt-1">Brain training</div>
                    </div>
                </div>

                <button onclick="showAllFeatures()" class="w-full mt-4 py-3 rounded-xl border border-gray-700 text-gray-400 hover:bg-gray-800 transition text-sm">
                    View 158+ More Features <i class="fas fa-arrow-right ml-2"></i>
                </button>
            </div>
        </div>

        <!-- AI DOCTOR PAGE -->
        <div id="aiDoctorPage" class="page px-4">
            <div class="glass rounded-2xl p-4 mb-4">
                <div class="flex items-center gap-4">
                    <div class="w-14 h-14 rounded-full bg-gradient-to-br from-purple-500 to-pink-600 flex items-center justify-center">
                        <i class="fas fa-user-md text-white text-2xl"></i>
                    </div>
                    <div>
                        <h2 class="font-bold text-xl">Dr. NutriSync AI</h2>
                        <p class="text-xs text-gray-400">Board Certified • 24/7 Available</p>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-2 mb-4">
                <button onclick="quickAsk('Create weight loss plan')" class="glass rounded-lg p-3 text-left text-sm hover:bg-purple-500/20 transition">
                    <i class="fas fa-apple-alt text-green-400 mr-2"></i>Weight Loss
                </button>
                <button onclick="quickAsk('Analyze sleep')" class="glass rounded-lg p-3 text-left text-sm hover:bg-purple-500/20 transition">
                    <i class="fas fa-moon text-blue-400 mr-2"></i>Sleep
                </button>
                <button onclick="quickAsk('Workout plan')" class="glass rounded-lg p-3 text-left text-sm hover:bg-purple-500/20 transition">
                    <i class="fas fa-dumbbell text-orange-400 mr-2"></i>Workout
                </button>
                <button onclick="quickAsk('HRV analysis')" class="glass rounded-lg p-3 text-left text-sm hover:bg-purple-500/20 transition">
                    <i class="fas fa-heartbeat text-red-400 mr-2"></i>HRV
                </button>
            </div>

            <div id="chatContainer" class="glass rounded-2xl p-4 mb-20 min-h-[400px] max-h-[500px] overflow-y-auto">
                <div class="chat-message chat-ai">
                    <div class="flex items-center gap-2 mb-1">
                        <i class="fas fa-robot text-purple-400"></i>
                        <span class="font-bold text-sm">Dr. NutriSync</span>
                    </div>
                    Welcome to your AI medical suite. How can I assist you today?
                </div>
            </div>

            <div class="fixed bottom-24 left-0 right-0 px-4 max-w-lg mx-auto">
                <div class="glass rounded-full p-2 flex items-center gap-2 border border-purple-500/30">
                    <input type="text" id="chatInput" placeholder="Ask anything..." 
                        class="flex-1 bg-transparent px-4 py-2 text-white outline-none"
                        onkeypress="if(event.key==='Enter')sendMessage()">
                    <button onclick="sendMessage()" class="w-10 h-10 rounded-full bg-gradient-to-br from-purple-500 to-pink-600 flex items-center justify-center">
                        <i class="fas fa-paper-plane text-white text-sm"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- DNA ANALYSIS PAGE -->
        <div id="dnaPage" class="page px-4">
            <div class="text-center mb-6">
                <div class="dna-helix mx-auto mb-4"></div>
                <h2 class="text-3xl font-bold gradient-text">DNA Analysis</h2>
                <p class="text-gray-400">Genetic-based nutrition optimization</p>
            </div>

            <div class="glass rounded-2xl p-6 mb-4 border border-yellow-500/20">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="font-bold">Genetic Markers</h3>
                    <span class="text-xs bg-yellow-500/20 text-yellow-400 px-2 py-1 rounded">Analyzed</span>
                </div>
                
                <div class="space-y-4">
                    <div class="flex items-center justify-between p-3 bg-gray-800/50 rounded-lg">
                        <div>
                            <div class="font-semibold">FTO Gene</div>
                            <div class="text-xs text-gray-400">Fat mass & obesity</div>
                        </div>
                        <div class="text-right">
                            <div class="text-yellow-400 font-bold">Variant AA</div>
                            <div class="text-xs text-gray-500">High impact</div>
                        </div>
                    </div>
                    
                    <div class="flex items-center justify-between p-3 bg-gray-800/50 rounded-lg">
                        <div>
                            <div class="font-semibold">MTHFR</div>
                            <div class="text-xs text-gray-400">Methylation</div>
                        </div>
                        <div class="text-right">
                            <div class="text-green-400 font-bold">Normal</div>
                            <div class="text-xs text-gray-500">Low impact</div>
                        </div>
                    </div>
                    
                    <div class="flex items-center justify-between p-3 bg-gray-800/50 rounded-lg">
                        <div>
                            <div class="font-semibold">APOE</div>
                            <div class="text-xs text-gray-400">Lipid metabolism</div>
                        </div>
                        <div class="text-right">
                            <div class="text-yellow-400 font-bold">E3/E4</div>
                            <div class="text-xs text-gray-500">Moderate</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="glass rounded-2xl p-6 mb-4">
                <h3 class="font-bold mb-4">Personalized Recommendations</h3>
                <div class="space-y-3">
                    <div class="flex gap-3 items-start">
                        <i class="fas fa-check-circle text-green-400 mt-1"></i>
                        <div>
                            <div class="font-semibold text-sm">Low Saturated Fat</div>
                            <div class="text-xs text-gray-400">Your APOE variant suggests limiting sat fat to <10% calories</div>
                        </div>
                    </div>
                    <div class="flex gap-3 items-start">
                        <i class="fas fa-check-circle text-green-400 mt-1"></i>
                        <div>
                            <div class="font-semibold text-sm">High Protein Breakfast</div>
                            <div class="text-xs text-gray-400">FTO variant responds well to 30g+ protein within 2 hours of waking</div>
                        </div>
                    </div>
                    <div class="flex gap-3 items-start">
                        <i class="fas fa-check-circle text-green-400 mt-1"></i>
                        <div>
                            <div class="font-semibold text-sm">Active Folate</div>
                            <div class="text-xs text-gray-400">MTHFR normal but optimize with 5-MTHF 400mcg daily</div>
                        </div>
                    </div>
                </div>
            </div>

            <button onclick="generateDNAPDF()" class="w-full py-4 rounded-xl bg-gradient-to-r from-yellow-500 to-orange-600 text-white font-bold shadow-lg">
                <i class="fas fa-file-download mr-2"></i>Download DNA Report
            </button>
        </div>

        <!-- VR TRAINING PAGE -->
        <div id="vrPage" class="page px-4">
            <div class="text-center mb-6">
                <i class="fas fa-vr-cardboard text-6xl text-purple-400 mb-4 block"></i>
                <h2 class="text-3xl font-bold gradient-text">VR Training</h2>
                <p class="text-gray-400">Immersive fitness environments</p>
            </div>

            <div class="vr-grid mb-6">
                <div class="vr-card" onclick="startVR('mountain')">
                    <i class="fas fa-mountain text-2xl"></i>
                </div>
                <div class="vr-card" onclick="startVR('space')">
                    <i class="fas fa-rocket text-2xl"></i>
                </div>
                <div class="vr-card" onclick="startVR('beach')">
                    <i class="fas fa-umbrella-beach text-2xl"></i>
                </div>
                <div class="vr-card" onclick="startVR('forest')">
                    <i class="fas fa-tree text-2xl"></i>
                </div>
                <div class="vr-card" onclick="startVR('city')">
                    <i class="fas fa-city text-2xl"></i>
                </div>
                <div class="vr-card" onclick="startVR('underwater')">
                    <i class="fas fa-water text-2xl"></i>
                </div>
            </div>

            <div class="glass rounded-2xl p-6 mb-4">
                <h3 class="font-bold mb-4">Current Session</h3>
                <div id="vrSession" class="text-center py-8 text-gray-500">
                    Select environment to begin
                </div>
                <div id="vrControls" class="hidden grid grid-cols-3 gap-2 mt-4">
                    <button onclick="pauseVR()" class="py-2 rounded-lg bg-gray-800 text-sm">Pause</button>
                    <button onclick="stopVR()" class="py-2 rounded-lg bg-red-500/20 text-red-400 text-sm">Stop</button>
                    <button onclick="intensityVR()" class="py-2 rounded-lg bg-purple-500/20 text-purple-400 text-sm">Intensity</button>
                </div>
            </div>

            <div class="glass rounded-2xl p-4">
                <div class="flex justify-between items-center mb-2">
                    <span class="text-sm text-gray-400">Weekly VR Time</span>
                    <span class="font-bold">4.5 hours</span>
                </div>
                <div class="h-2 bg-gray-800 rounded-full overflow-hidden">
                    <div class="h-full bg-gradient-to-r from-purple-500 to-pink-500 w-[65%]"></div>
                </div>
            </div>
        </div>

        <!-- FAMILY NETWORK PAGE -->
        <div id="familyPage" class="page px-4">
            <div class="text-center mb-6">
                <i class="fas fa-users text-6xl text-blue-400 mb-4 block"></i>
                <h2 class="text-3xl font-bold gradient-text">Family Network</h2>
                <p class="text-gray-400">Connected health tracking</p>
            </div>

            <div class="glass rounded-2xl p-6 mb-4">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="font-bold">Family Members</h3>
                    <button onclick="addFamilyMember()" class="text-sm bg-blue-500/20 text-blue-400 px-3 py-1 rounded-full">
                        <i class="fas fa-plus mr-1"></i>Add
                    </button>
                </div>
                
                <div id="familyList" class="space-y-3">
                    <div class="flex items-center gap-3 p-3 bg-gray-800/50 rounded-lg">
                        <div class="w-10 h-10 rounded-full bg-gradient-to-br from-cyan-400 to-blue-600 flex items-center justify-center">
                            <i class="fas fa-user text-white"></i>
                        </div>
                        <div class="flex-1">
                            <div class="font-semibold">You</div>
                            <div class="text-xs text-gray-400">Admin • 72kg</div>
                        </div>
                        <div class="w-2 h-2 rounded-full bg-green-400"></div>
                    </div>
                </div>
            </div>

            <div class="glass rounded-2xl p-6 mb-4">
                <h3 class="font-bold mb-4">Group Challenges</h3>
                <div class="space-y-3">
                    <div class="p-3 bg-gradient-to-r from-blue-500/10 to-cyan-500/10 rounded-lg border border-blue-500/20">
                        <div class="flex justify-between items-center mb-1">
                            <span class="font-semibold">10K Steps Daily</span>
                            <span class="text-xs bg-blue-500 text-white px-2 py-0.5 rounded">Active</span>
                        </div>
                        <div class="text-xs text-gray-400 mb-2">3 of 4 members completed today</div>
                        <div class="h-1.5 bg-gray-800 rounded-full overflow-hidden">
                            <div class="h-full bg-blue-500 w-[75%]"></div>
                        </div>
                    </div>
                    
                    <div class="p-3 bg-gray-800/30 rounded-lg border border-gray-700">
                        <div class="flex justify-between items-center mb-1">
                            <span class="font-semibold">No Sugar Week</span>
                            <span class="text-xs bg-gray-700 text-gray-400 px-2 py-0.5 rounded">Starts Monday</span>
                        </div>
                        <div class="text-xs text-gray-400">4 members joined</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- AI COACH PAGE -->
        <div id="coachPage" class="page px-4">
            <div class="text-center mb-6">
                <i class="fas fa-robot text-6xl text-green-400 mb-4 block"></i>
                <h2 class="text-3xl font-bold gradient-text">AI Coach</h2>
                <p class="text-gray-400">Real-time form correction</p>
            </div>

            <div class="glass rounded-2xl p-6 mb-4 border border-green-500/20">
                <div class="aspect-video bg-gray-900 rounded-xl mb-4 flex items-center justify-center relative overflow-hidden">
                    <div class="absolute inset-0 flex items-center justify-center">
                        <i class="fas fa-camera text-4xl text-gray-700"></i>
                    </div>
                    <div class="absolute bottom-4 left-4 right-4">
                        <div class="bg-black/50 backdrop-blur rounded-lg p-3 text-sm">
                            <div class="flex items-center gap-2 text-green-400 mb-1">
                                <i class="fas fa-check-circle"></i>
                                <span class="font-bold">Form: Excellent</span>
                            </div>
                            <div class="text-gray-300 text-xs">Hip alignment optimal • Knee valgus minimal</div>
                        </div>
                    </div>
                    <!-- Skeleton overlay simulation -->
                    <svg class="absolute inset-0 w-full h-full opacity-30" viewBox="0 0 400 300">
                        <line x1="200" y1="50" x2="200" y2="150" stroke="#10b981" stroke-width="3" stroke-linecap="round"/>
                        <line x1="200" y1="100" x2="150" y2="80" stroke="#10b981" stroke-width="3" stroke-linecap="round"/>
                        <line x1="200" y1="100" x2="250" y2="80" stroke="#10b981" stroke-width="3" stroke-linecap="round"/>
                        <line x1="200" y1="150" x2="170" y2="220" stroke="#10b981" stroke-width="3" stroke-linecap="round"/>
                        <line x1="200" y1="150" x2="230" y2="220" stroke="#10b981" stroke-width="3" stroke-linecap="round"/>
                    </svg>
                </div>
                
                <div class="grid grid-cols-3 gap-2 text-center">
                    <div class="bg-gray-800/50 rounded-lg p-2">
                        <div class="text-2xl font-bold text-green-400">94%</div>
                        <div class="text-xs text-gray-400">Form Score</div>
                    </div>
                    <div class="bg-gray-800/50 rounded-lg p-2">
                        <div class="text-2xl font-bold text-blue-400">12</div>
                        <div class="text-xs text-gray-400">Reps Count</div>
                    </div>
                    <div class="bg-gray-800/50 rounded-lg p-2">
                        <div class="text-2xl font-bold text-purple-400">340</div>
                        <div class="text-xs text-gray-400">Calories</div>
                    </div>
                </div>
            </div>

            <div class="space-y-2">
                <button onclick="startCoaching('squat')" class="w-full py-3 rounded-xl bg-gray-800 hover:bg-gray-700 transition flex items-center justify-between px-4">
                    <span><i class="fas fa-walking mr-2 text-green-400"></i>Squat Form</span>
                    <i class="fas fa-chevron-right text-gray-500"></i>
                </button>
                <button onclick="startCoaching('deadlift')" class="w-full py-3 rounded-xl bg-gray-800 hover:bg-gray-700 transition flex items-center justify-between px-4">
                    <span><i class="fas fa-dumbbell mr-2 text-blue-400"></i>Deadlift Form</span>
                    <i class="fas fa-chevron-right text-gray-500"></i>
                </button>
                <button onclick="startCoaching('yoga')" class="w-full py-3 rounded-xl bg-gray-800 hover:bg-gray-700 transition flex items-center justify-between px-4">
                    <span><i class="fas fa-spa mr-2 text-purple-400"></i>Yoga Alignment</span>
                    <i class="fas fa-chevron-right text-gray-500"></i>
                </button>
            </div>
        </div>

        <!-- CLINICAL REPORTS PAGE -->
        <div id="reportsPage" class="page px-4">
            <div class="text-center mb-6">
                <i class="fas fa-file-medical text-6xl text-red-400 mb-4 block"></i>
                <h2 class="text-3xl font-bold gradient-text">Clinical Reports</h2>
                <p class="text-gray-400">Medical-grade documentation</p>
            </div>

            <div class="space-y-3 mb-6">
                <div class="glass rounded-xl p-4 border border-red-500/20">
                    <div class="flex items-center justify-between mb-2">
                        <div>
                            <div class="font-bold">90-Day Metabolic Panel</div>
                            <div class="text-xs text-gray-400">Generated Jan 15, 2026</div>
                        </div>
                        <i class="fas fa-file-pdf text-3xl text-red-400"></i>
                    </div>
                    <button onclick="downloadReport('metabolic')" class="w-full py-2 rounded-lg bg-red-500/20 text-red-400 text-sm font-semibold">
                        <i class="fas fa-download mr-2"></i>Download PDF
                    </button>
                </div>

                <div class="glass rounded-xl p-4 border border-gray-700">
                    <div class="flex items-center justify-between mb-2">
                        <div>
                            <div class="font-bold">Body Composition Analysis</div>
                            <div class="text-xs text-gray-400">Generated Jan 10, 2026</div>
                        </div>
                        <i class="fas fa-file-pdf text-3xl text-gray-500"></i>
                    </div>
                    <button onclick="downloadReport('bodycomp')" class="w-full py-2 rounded-lg bg-gray-800 text-gray-400 text-sm font-semibold">
                        <i class="fas fa-download mr-2"></i>Download PDF
                    </button>
                </div>

                <div class="glass rounded-xl p-4 border border-gray-700">
                    <div class="flex items-center justify-between mb-2">
                        <div>
                            <div class="font-bold">Sleep Architecture Report</div>
                            <div class="text-xs text-gray-400">Generated Jan 5, 2026</div>
                        </div>
                        <i class="fas fa-file-pdf text-3xl text-gray-500"></i>
                    </div>
                    <button onclick="downloadReport('sleep')" class="w-full py-2 rounded-lg bg-gray-800 text-gray-400 text-sm font-semibold">
                        <i class="fas fa-download mr-2"></i>Download PDF
                    </button>
                </div>
            </div>

            <button onclick="generateNewReport()" class="w-full py-4 rounded-xl bg-gradient-to-r from-red-500 to-rose-600 text-white font-bold shadow-lg">
                <i class="fas fa-plus-circle mr-2"></i>Generate New Report
            </button>
        </div>

        <!-- HRV MONITOR PAGE -->
        <div id="hrvPage" class="page px-4">
            <div class="text-center mb-6">
                <i class="fas fa-heartbeat text-6xl text-pink-400 mb-4 block animate-pulse"></i>
                <h2 class="text-3xl font-bold gradient-text">HRV Monitor</h2>
                <p class="text-gray-400">Autonomic nervous system tracking</p>
            </div>

            <div class="glass rounded-2xl p-6 mb-4 border border-pink-500/20">
                <div class="flex justify-between items-end mb-4">
                    <div>
                        <div class="text-gray-400 text-sm mb-1">Current RMSSD</div>
                        <div class="text-5xl font-bold text-pink-400" id="hrvValue">45</div>
                        <div class="text-sm text-gray-400">ms</div>
                    </div>
                    <div class="text-right">
                        <div class="inline-block px-3 py-1 rounded-full bg-yellow-500/20 text-yellow-400 text-sm font-bold">
                            Moderate
                        </div>
                    </div>
                </div>
                
                <div class="hrv-graph mb-4">
                    <div class="hrv-line"></div>
                </div>

                <div class="grid grid-cols-3 gap-2 text-center text-xs">
                    <div class="bg-gray-800/50 rounded-lg p-2">
                        <div class="text-gray-400">LF/HF</div>
                        <div class="font-bold text-lg">2.4</div>
                    </div>
                    <div class="bg-gray-800/50 rounded-lg p-2">
                        <div class="text-gray-400">pNN50</div>
                        <div class="font-bold text-lg">12%</div>
                    </div>
                    <div class="bg-gray-800/50 rounded-lg p-2">
                        <div class="text-gray-400">SDNN</div>
                        <div class="font-bold text-lg">38ms</div>
                    </div>
                </div>
            </div>

            <div class="glass rounded-2xl p-6">
                <h3 class="font-bold mb-4">Stress Recommendations</h3>
                <div class="space-y-3">
                    <div class="flex items-center gap-3 p-3 bg-pink-500/10 rounded-lg border border-pink-500/20">
                        <i class="fas fa-wind text-pink-400 text-xl"></i>
                        <div class="flex-1">
                            <div class="font-semibold text-sm">Resonant Breathing</div>
                            <div class="text-xs text-gray-400">5.5 breaths/min for 10 mins</div>
                        </div>
                        <button onclick="startBreathingProtocol()" class="px-3 py-1 rounded-full bg-pink-500 text-white text-xs">Start</button>
                    </div>
                    <div class="flex items-center gap-3 p-3 bg-blue-500/10 rounded-lg border border-blue-500/20">
                        <i class="fas fa-bed text-blue-400 text-xl"></i>
                        <div class="flex-1">
                            <div class="font-semibold text-sm">Sleep Extension</div>
                            <div class="text-xs text-gray-400">Target 8+ hours tonight</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- GUT BIOME PAGE -->
        <div id="gutPage" class="page px-4">
            <div class="text-center mb-6">
                <i class="fas fa-bacteria text-6xl text-teal-400 mb-4 block"></i>
                <h2 class="text-3xl font-bold gradient-text">Gut Biome</h2>
                <p class="text-gray-400">Microbiome analysis & optimization</p>
            </div>

            <div class="glass rounded-2xl p-6 mb-4 border border-teal-500/20 relative overflow-hidden" style="height: 200px;">
                <div class="absolute inset-0" id="bacteriaContainer">
                    <!-- Bacteria animated via JS -->
                </div>
                <div class="relative z-10 text-center pt-8">
                    <div class="text-4xl font-bold text-teal-400 mb-2">84%</div>
                    <div class="text-sm text-gray-300">Microbiome Diversity Score</div>
                    <div class="text-xs text-gray-400 mt-1">Optimal range: 80-95%</div>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-3 mb-4">
                <div class="glass rounded-xl p-3 text-center">
                    <div class="text-2xl font-bold text-green-400">Firmicutes</div>
                    <div class="text-xs text-gray-400">62% • Normal</div>
                </div>
                <div class="glass rounded-xl p-3 text-center">
                    <div class="text-2xl font-bold text-blue-400">Bacteroidetes</div>
                    <div class="text-xs text-gray-400">28% • Normal</div>
                </div>
                <div class="glass rounded-xl p-3 text-center">
                    <div class="text-2xl font-bold text-yellow-400">Actinobacteria</div>
                    <div class="text-xs text-gray-400">7% • Low</div>
                </div>
                <div class="glass rounded-xl p-3 text-center">
                    <div class="text-2xl font-bold text-purple-400">Proteobacteria</div>
                    <div class="text-xs text-gray-400">3% • Optimal</div>
                </div>
            </div>

            <div class="glass rounded-2xl p-6">
                <h3 class="font-bold mb-4">Biome-Friendly Foods</h3>
                <div class="space-y-2">
                    <div class="flex items-center justify-between p-2 bg-gray-800/50 rounded-lg">
                        <span class="text-sm"><i class="fas fa-check text-green-400 mr-2"></i>Kimchi (Lactobacillus)</span>
                        <span class="text-xs text-teal-400">+15% diversity</span>
                    </div>
                    <div class="flex items-center justify-between p-2 bg-gray-800/50 rounded-lg">
                        <span class="text-sm"><i class="fas fa-check text-green-400 mr-2"></i>Jerusalem Artichoke</span>
                        <span class="text-xs text-teal-400">Inulin fiber</span>
                    </div>
                    <div class="flex items-center justify-between p-2 bg-gray-800/50 rounded-lg">
                        <span class="text-sm"><i class="fas fa-check text-green-400 mr-2"></i>Kefir (Multi-strain)</span>
                        <span class="text-xs text-teal-400">12 species</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- NEUROFEEDBACK PAGE -->
        <div id="neuroPage" class="page px-4">
            <div class="text-center mb-6">
                <i class="fas fa-brain text-6xl text-indigo-400 mb-4 block"></i>
                <h2 class="text-3xl font-bold gradient-text">Neurofeedback</h2>
                <p class="text-gray-400">EEG-based brain training</p>
            </div>

            <div class="glass rounded-2xl p-6 mb-4 border border-indigo-500/20">
                <div class="flex justify-between items-center mb-6">
                    <div>
                        <div class="text-gray-400 text-sm">Current State</div>
                        <div class="text-2xl font-bold text-indigo-400" id="brainState">Focused</div>
                    </div>
                    <div class="w-16 h-16 rounded-full border-4 border-indigo-500/30 border-t-indigo-400 animate-spin"></div>
                </div>

                <div class="space-y-3">
                    <div>
                        <div class="flex justify-between text-sm mb-1">
                            <span class="text-gray-400">Beta (13-30Hz)</span>
                            <span class="text-indigo-400">Active</span>
                        </div>
                        <div class="h-2 bg-gray-800 rounded-full overflow-hidden">
                            <div class="h-full bg-indigo-400 w-[75%] animate-pulse"></div>
                        </div>
                    </div>
                    <div>
                        <div class="flex justify-between text-sm mb-1">
                            <span class="text-gray-400">Alpha (8-13Hz)</span>
                            <span class="text-purple-400">Relaxed</span>
                        </div>
                        <div class="h-2 bg-gray-800 rounded-full overflow-hidden">
                            <div class="h-full bg-purple-400 w-[45%]"></div>
                        </div>
                    </div>
                    <div>
                        <div class="flex justify-between text-sm mb-1">
                            <span class="text-gray-400">Theta (4-8Hz)</span>
                            <span class="text-blue-400">Deep</span>
                        </div>
                        <div class="h-2 bg-gray-800 rounded-full overflow-hidden">
                            <div class="h-full bg-blue-400 w-[20%]"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-3">
                <button onclick="startNeuroProtocol('focus')" class="glass rounded-xl p-4 text-center hover:border-indigo-500/50 transition border border-transparent">
                    <i class="fas fa-bullseye text-3xl text-indigo-400 mb-2 block"></i>
                    <div class="font-bold text-sm">Focus</div>
                    <div class="text-xs text-gray-400">40Hz gamma</div>
                </button>
                <button onclick="startNeuroProtocol('relax')" class="glass rounded-xl p-4 text-center hover:border-purple-500/50 transition border border-transparent">
                    <i class="fas fa-spa text-3xl text-purple-400 mb-2 block"></i>
                    <div class="font-bold text-sm">Relax</div>
                    <div class="text-xs text-gray-400">10Hz alpha</div>
                </button>
                <button onclick="startNeuroProtocol('sleep')" class="glass rounded-xl p-4 text-center hover:border-blue-500/50 transition border border-transparent">
                    <i class="fas fa-bed text-3xl text-blue-400 mb-2 block"></i>
                    <div class="font-bold text-sm">Sleep</div>
                    <div class="text-xs text-gray-400">4Hz delta</div>
                </button>
                <button onclick="startNeuroProtocol('creativity')" class="glass rounded-xl p-4 text-center hover:border-pink-500/50 transition border border-transparent">
                    <i class="fas fa-lightbulb text-3xl text-pink-400 mb-2 block"></i>
                    <div class="font-bold text-sm">Create</div>
                    <div class="text-xs text-gray-400">7.83Hz Schumann</div>
                </button>
            </div>
        </div>

        <!-- ALL FEATURES LIST PAGE -->
        <div id="allFeaturesPage" class="page px-4">
            <div class="flex items-center gap-4 mb-6">
                <button onclick="goBack()" class="w-10 h-10 rounded-full bg-gray-800 flex items-center justify-center">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <div>
                    <h2 class="text-2xl font-bold">All Features</h2>
                    <p class="text-sm text-gray-400">174+ Premium Tools</p>
                </div>
            </div>

            <div class="mb-4">
                <input type="text" placeholder="Search features..." 
                    class="w-full px-4 py-3 rounded-xl bg-gray-800/50 border border-gray-700 focus:border-cyan-500 focus:outline-none"
                    oninput="searchFeatures(this.value)">
            </div>

            <div id="featuresList" class="space-y-2 max-h-[600px] overflow-y-auto">
                <!-- Populated by JS -->
            </div>
        </div>

    </div>

    <!-- BOTTOM NAV -->
    <nav class="fixed bottom-0 w-full max-w-lg mx-auto left-0 right-0 z-40 glass-strong border-t border-gray-800">
        <div class="flex justify-around py-3">
            <button onclick="showPage('home')" class="nav-item active flex flex-col items-center gap-1 text-gray-500" data-page="home">
                <i class="fas fa-home text-xl"></i>
                <span class="text-[10px]">Home</span>
            </button>
            <button onclick="showPage('aiDoctor')" class="nav-item flex flex-col items-center gap-1 text-gray-500" data-page="aiDoctor">
                <i class="fas fa-user-md text-xl"></i>
                <span class="text-[10px]">AI Doctor</span>
            </button>
            <button onclick="showFeature('coach')" class="nav-item flex flex-col items-center gap-1 text-gray-500">
                <i class="fas fa-dumbbell text-xl"></i>
                <span class="text-[10px]">Train</span>
            </button>
            <button onclick="showProStatus()" class="nav-item flex flex-col items-center gap-1 text-gray-500">
                <i class="fas fa-crown text-xl"></i>
                <span class="text-[10px]">Pro</span>
            </button>
        </div>
    </nav>

    <script>
        // State
        let isPro = false;
        let profile = { age: null, height: null, weight: null, goalWeight: null };
        let weightHistory = [];
        let weightChart = null;
        let currentPage = 'home';
        let pageHistory = [];

        // Secret Code System
        const ACCESS_CODE = 'architect_x_2025';
        let keyBuffer = '';
        let bufferTimer = null;

        document.addEventListener('keydown', (e) => {
            keyBuffer += e.key.toLowerCase();
            clearTimeout(bufferTimer);
            bufferTimer = setTimeout(() => { keyBuffer = ''; }, 2000);
            if (keyBuffer.length > ACCESS_CODE.length) keyBuffer = keyBuffer.slice(-ACCESS_CODE.length);
            if (keyBuffer === ACCESS_CODE) {
                unlockPro();
                keyBuffer = '';
            }
        });

        // Initialization
        window.onload = () => {
            loadData();
            checkProStatus();
            updateDashboard();
            initChart();
            populateAllFeatures();
        };

        function loadData() {
            const saved = localStorage.getItem('nutrisync_profile');
            const savedHistory = localStorage.getItem('nutrisync_history');
            const savedPro = localStorage.getItem('nutrisync_pro');
            if (saved) profile = JSON.parse(saved);
            if (savedHistory) weightHistory = JSON.parse(savedHistory);
            if (savedPro === 'true') isPro = true;
        }

        function saveData() {
            localStorage.setItem('nutrisync_profile', JSON.stringify(profile));
            localStorage.setItem('nutrisync_history', JSON.stringify(weightHistory));
            localStorage.setItem('nutrisync_pro', isPro);
        }

        function checkProStatus() {
            if (isPro) {
                unlockPro(false);
                document.getElementById('accessOverlay').classList.add('hidden');
            }
        }

        function validateAccess() {
            const input = document.getElementById('accessCodeInput').value.trim();
            if (input === ACCESS_CODE) {
                unlockPro();
                document.getElementById('accessOverlay').classList.add('hidden');
            } else {
                document.getElementById('accessError').classList.remove('hidden');
                setTimeout(() => document.getElementById('accessError').classList.add('hidden'), 3000);
            }
        }

        function continueLimited() {
            document.getElementById('accessOverlay').classList.add('hidden');
        }

        function unlockPro(showToast = true) {
            isPro = true;
            saveData();
            document.getElementById('proBadge').classList.remove('hidden');
            document.getElementById('proFeaturesGrid').classList.remove('locked');
            document.getElementById('proFeaturesGrid').classList.add('unlocked');
            
            if (showToast) {
                document.getElementById('proToast').classList.add('show');
                setTimeout(() => document.getElementById('proToast').classList.remove('show'), 4000);
            }
        }

        function showProStatus() {
            if (!isPro) {
                document.getElementById('accessOverlay').classList.remove('hidden');
            } else {
                showPage('home');
                setTimeout(() => {
                    document.getElementById('proFeaturesGrid').scrollIntoView({ behavior: 'smooth' });
                }, 100);
            }
        }

        // Navigation System
        function showPage(page) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            
            if (page === 'home') {
                document.getElementById('homePage').classList.add('active');
                document.querySelector('[data-page="home"]').classList.add('active');
                updateHeader('Command Center', 'Your health ecosystem');
            } else if (page === 'aiDoctor') {
                if (!isPro) { showProStatus(); return; }
                document.getElementById('aiDoctorPage').classList.add('active');
                document.querySelector('[data-page="aiDoctor"]').classList.add('active');
                updateHeader('AI Doctor', 'Medical intelligence');
            }
            
            currentPage = page;
        }

        function showFeature(feature) {
            if (!isPro && feature !== 'profile') {
                showProStatus();
                return;
            }
            
            pageHistory.push(currentPage);
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            
            const featurePages = {
                'dna': 'dnaPage',
                'vr': 'vrPage',
                'family': 'familyPage',
                'coach': 'coachPage',
                'reports': 'reportsPage',
                'hrv': 'hrvPage',
                'gut': 'gutPage',
                'neuro': 'neuroPage',
                'aiDoctor': 'aiDoctorPage'
            };
            
            if (featurePages[feature]) {
                document.getElementById(featurePages[feature]).classList.add('active');
                document.getElementById('backBtn').classList.remove('hidden');
                
                const titles = {
                    'dna': 'DNA Analysis',
                    'vr': 'VR Training',
                    'family': 'Family Network',
                    'coach': 'AI Coach',
                    'reports': 'Clinical Reports',
                    'hrv': 'HRV Monitor',
                    'gut': 'Gut Biome',
                    'neuro': 'Neurofeedback',
                    'aiDoctor': 'AI Doctor'
                };
                updateHeader(titles[feature], 'Pro Feature');
            }
        }

        function goBack() {
            const prev = pageHistory.pop() || 'home';
            showPage(prev);
            document.getElementById('backBtn').classList.add('hidden');
        }

        function updateHeader(title, subtitle) {
            document.getElementById('pageTitle').textContent = title;
            document.getElementById('pageSubtitle').textContent = subtitle;
        }

        // Dashboard
        function updateDashboard() {
            document.getElementById('displayWeight').textContent = profile.weight ? profile.weight + ' kg' : '--';
            document.getElementById('displayGoalWeight').textContent = profile.goalWeight ? profile.goalWeight + ' kg' : '--';
            
            if (profile.height && profile.weight) {
                const bmi = (profile.weight / ((profile.height/100) ** 2)).toFixed(1);
                document.getElementById('displayBMI').textContent = bmi;
            }
        }

        function initChart() {
            const ctx = document.getElementById('weightChart').getContext('2d');
            weightChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: weightHistory.map(h => h.date),
                    datasets: [{
                        label: 'Weight',
                        data: weightHistory.map(h => h.weight),
                        borderColor: '#06b6d4',
                        backgroundColor: 'rgba(6, 182, 212, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { grid: { color: 'rgba(255,255,255,0.1)' }, ticks: { color: '#9ca3af' } },
                        x: { grid: { display: false }, ticks: { color: '#9ca3af' } }
                    }
                }
            });
        }

        // AI Doctor
        function quickAsk(q) {
            document.getElementById('chatInput').value = q;
            sendMessage();
        }

        function sendMessage() {
            const input = document.getElementById('chatInput');
            const text = input.value.trim();
            if (!text) return;
            
            addChatMessage(text, 'user');
            input.value = '';
            
            setTimeout(() => {
                const response = generateResponse(text);
                addChatMessage(response, 'ai');
            }, 1000);
        }

        function addChatMessage(text, sender) {
            const container = document.getElementById('chatContainer');
            const div = document.createElement('div');
            div.className = `chat-message chat-${sender}`;
            if (sender === 'ai') {
                div.innerHTML = `<div class="flex items-center gap-2 mb-1"><i class="fas fa-robot text-purple-400"></i><span class="font-bold text-sm">Dr. NutriSync</span></div>${text}`;
            } else {
                div.textContent = text;
            }
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        }

        function generateResponse(input) {
            if (input.includes('weight')) return "Based on your profile, I recommend a 500-calorie deficit with high protein intake. Your current trajectory shows excellent progress.";
            if (input.includes('sleep')) return "Your sleep architecture suggests increasing deep sleep by 15%. Try magnesium glycinate 400mg before bed.";
            return "I've analyzed your health data. Your metrics are improving. Continue with your current protocol and consider increasing NEAT activity by 10%.";
        }

        // Feature Implementations
        function generateDNAPDF() {
            alert('Generating comprehensive DNA analysis PDF...\n\nIncluding:\n• Genetic risk factors\n• Nutritional recommendations\n• Supplement protocols\n• Lifestyle modifications');
        }

        let vrActive = false;
        function startVR(env) {
            vrActive = true;
            document.getElementById('vrSession').innerHTML = `
                <div class="text-2xl font-bold mb-2 gradient-text">${env.charAt(0).toUpperCase() + env.slice(1)} Environment</div>
                <div class="text-green-400"><i class="fas fa-circle text-xs animate-pulse mr-2"></i>Connected to VR Headset</div>
                <div class="mt-4 text-sm text-gray-400">Session: 00:00</div>
            `;
            document.getElementById('vrControls').classList.remove('hidden');
        }

        function pauseVR() { alert('VR Session Paused'); }
        function stopVR() { 
            vrActive = false; 
            document.getElementById('vrSession').textContent = 'Select environment to begin';
            document.getElementById('vrControls').classList.add('hidden');
        }
        function intensityVR() { alert('Adjusting intensity level...'); }

        function addFamilyMember() {
            const name = prompt('Enter family member name:');
            if (name) {
                const list = document.getElementById('familyList');
                const div = document.createElement('div');
                div.className = 'flex items-center gap-3 p-3 bg-gray-800/50 rounded-lg';
                div.innerHTML = `
                    <div class="w-10 h-10 rounded-full bg-gradient-to-br from-green-400 to-blue-600 flex items-center justify-center">
                        <i class="fas fa-user text-white"></i>
                    </div>
                    <div class="flex-1">
                        <div class="font-semibold">${name}</div>
                        <div class="text-xs text-gray-400">Member • Pending invite</div>
                    </div>
                `;
                list.appendChild(div);
            }
        }

        function startCoaching(exercise) {
            alert(`Starting AI coaching for ${exercise}...\n\n• Camera analyzing form\n• Real-time feedback active\n• Voice guidance enabled`);
        }

        function downloadReport(type) {
            alert(`Generating ${type} report PDF...\n\nReport includes:\n• 90-day trend analysis\n• Medical-grade charts\n• Physician-ready formatting`);
        }

        function generateNewReport() {
            alert('Select report type:\n\n1. Comprehensive Metabolic Panel\n2. Hormone Profile\n3. Cardiovascular Risk\n4. Nutritional Deficiency');
        }

        function startBreathingProtocol() {
            alert('Starting resonant breathing protocol...\n\nInhale: 5.5 seconds\nExhale: 5.5 seconds\n\nTarget: 10 minutes to increase HRV');
        }

        // Gut bacteria animation
        function initBacteria() {
            const container = document.getElementById('bacteriaContainer');
            if (!container) return;
            container.innerHTML = '';
            for (let i = 0; i < 15; i++) {
                const b = document.createElement('div');
                b.className = 'gut-bacteria';
                b.style.left = Math.random() * 100 + '%';
                b.style.top = Math.random() * 100 + '%';
                b.style.animationDelay = Math.random() * 3 + 's';
                b.style.background = ['#10b981', '#3b82f6', '#8b5cf6', '#f59e0b'][Math.floor(Math.random() * 4)];
                container.appendChild(b);
            }
        }

        function startNeuroProtocol(type) {
            const states = { 'focus': '40Hz Gamma - Focus Mode', 'relax': '10Hz Alpha - Relaxation', 'sleep': '4Hz Delta - Deep Sleep', 'creativity': '7.83Hz Schumann - Flow State' };
            document.getElementById('brainState').textContent = states[type] || 'Optimized';
            alert(`Starting ${type} neurofeedback protocol...\n\n• EEG sensors calibrating\n• Audio-visual entrainment beginning\n• Session: 20 minutes`);
        }

        // All Features List
        const allFeaturesList = [
            'DNA-Based Nutrition', 'VR Immersive Training', 'Family Health Network', 'AI Form Correction',
            'Clinical PDF Reports', 'HRV Stress Monitor', 'Gut Microbiome Analysis', 'Neurofeedback Training',
            'Blood Glucose Prediction', 'Sleep Architecture Analysis', 'Periodization Planning', 'Metabolic Testing',
            'Body Composition Scan', 'Food Sensitivity Testing', 'Supplement Stack Optimizer', 'Longevity Biomarkers',
            'Hormone Panel Tracking', 'Heart Rate Zones', 'VO2 Max Estimation', 'Recovery Score',
            'Mindfulness Metrics', 'Posture Analysis', 'Gait Assessment', 'Fall Risk Prediction',
            'Cognitive Testing', 'Memory Games', 'Reaction Time', 'Processing Speed',
            'Meditation Guidance', 'Breathwork Protocols', 'Cold Exposure Timer', 'Heat Therapy Log',
            'Fasting Tracker', 'Ketone Monitoring', 'Glucose Monitoring', 'Insulin Sensitivity',
            'Thyroid Function', 'Adrenal Health', 'Cortisol Patterns', 'DHEA Levels',
            'Testosterone Tracking', 'Estrogen Metabolism', 'Progesterone Cycle', 'LH/FSH Ratio',
            'Inflammation Markers', 'Omega-3 Index', 'Vitamin D Status', 'B12 Monitoring',
            'Iron Panel', 'Ferritin Tracking', 'Zinc Status', 'Magnesium RBC',
            'Telomere Length', 'DNA Methylation', 'Cellular Senescence', 'Autophagy Indicators',
            'Protein Intake Optimization', 'Amino Acid Profile', 'Leucine Threshold', 'MTOR Signaling',
            'AMPK Activation', 'Sirtuin Pathways', 'NAD+ Levels', 'Mitochondrial Function',
            'ATP Production', 'Oxidative Stress', 'Antioxidant Status', 'Glutathione Levels',
            'Detoxification Pathways', 'Liver Function', 'Kidney Function', 'GFR Estimation',
            'Electrolyte Balance', 'Hydration Status', 'Sodium/Potassium Ratio', 'Magnesium Status',
            'Calcium Metabolism', 'Bone Density Estimation', 'Joint Health', 'Cartilage Support',
            'Collagen Synthesis', 'Skin Elasticity', 'Wrinkle Depth Analysis', 'UV Damage Assessment',
            'Photoaging Protection', 'Antioxidant Topicals', 'Peptide Therapy', 'Stem Cell Support',
            'Exosome Tracking', 'PRP Monitoring', 'Ozone Therapy Log', 'HBOT Sessions',
            'Red Light Therapy', 'Infrared Sauna', 'Cryotherapy', 'PEMF Therapy',
            'TENS/EMS Training', 'Blood Flow Restriction', 'Occlusion Training', 'Hypoxic Training',
            'Altitude Simulation', 'Underwater Training', 'Aquatic Therapy', 'Hydrotherapy',
            'Contrast Baths', 'Foam Rolling', 'Myofascial Release', 'Trigger Point Therapy',
            'Acupressure', 'Reflexology', 'Craniosacral', 'Lymphatic Drainage',
            'Dry Brushing', 'Cupping Therapy', 'Gua Sha', 'CBD Integration',
            'Nootropic Stacks', 'Adaptogen Protocols', 'Mushroom Extracts', 'Herbal Supplements',
            'Traditional Chinese Medicine', 'Ayurvedic Constitution', 'Dosha Balancing', 'Chakra Alignment',
            'Reiki Energy', 'Qi Gong', 'Tai Chi Advanced', 'Baguazhang',
            'Systema', 'Wim Hof Method', 'Buteyko Breathing', 'Pranayama',
            'Holotropic Breathwork', 'Rebirthing', 'Bioenergetics', 'Somatic Experiencing',
            'EMDR Self-Help', 'Tapping/EFT', 'NLP Techniques', 'Cognitive Behavioral Tools',
            'Dialectical Behavior', 'Acceptance Commitment', 'Positive Psychology', 'Flow State Triggers',
            'Creativity Boosters', 'Learning Acceleration', 'Language Learning', 'Muscle Memory',
            'Motor Control', 'Proprioception', 'Balance Training', 'Coordination Drills',
            'Reaction Training', 'Agility Ladder', 'Plyometrics', 'Isometrics',
            'Eccentric Training', 'Concentric Focus', 'Isokinetic', 'Variable Resistance',
            'Band Work', 'Chain Training', 'Suspension', 'Calisthenics',
            'Street Workout', 'Parkour', 'Gymnastics', 'Dance Therapy',
            'Music Therapy', 'Sound Healing', 'Binaural Beats', 'Isochronic Tones',
            'Solfeggio Frequencies', 'Chakra Tuning', 'Planetary Gongs', 'Crystal Singing',
            'Drum Circles', 'Rhythm Therapy', 'Voice Analysis', 'Toning Exercises',
            'Mantra Meditation', 'Kundalini Yoga', 'Ashtanga Primary', 'Vinyasa Flow',
            'Yin Yoga', 'Restorative', 'Nidra Yoga', 'Kriya Yoga',
            'Bhakti Practices', 'Jnana Meditation', 'Karma Yoga', 'Raja Yoga',
            'Tantra Practices', 'Sexual Health', 'Fertility Tracking', 'Prenatal Care',
            'Postnatal Recovery', 'Pediatric Nutrition', 'Geriatric Support', 'Menopause Management',
            'Andropause Support', 'Cycle Syncing', 'Seed Cycling', 'Moon Phase Training'
        ];

        function populateAllFeatures() {
            const container = document.getElementById('featuresList');
            if (!container) return;
            container.innerHTML = allFeaturesList.map(f => `
                <div class="glass rounded-lg p-3 flex items-center justify-between cursor-pointer hover:bg-gray-800/50 transition" onclick="alert('${f} - Full implementation loading...')">
                    <div class="flex items-center gap-3">
                        <i class="fas fa-star text-yellow-400"></i>
                        <span class="font-medium">${f}</span>
                    </div>
                    <i class="fas fa-chevron-right text-gray-500 text-sm"></i>
                </div>
            `).join('');
        }

        function searchFeatures(query) {
            const container = document.getElementById('featuresList');
            const filtered = allFeaturesList.filter(f => f.toLowerCase().includes(query.toLowerCase()));
            container.innerHTML = filtered.map(f => `
                <div class="glass rounded-lg p-3 flex items-center justify-between cursor-pointer hover:bg-gray-800/50 transition" onclick="alert('${f} - Full implementation loading...')">
                    <div class="flex items-center gap-3">
                        <i class="fas fa-star text-yellow-400"></i>
                        <span class="font-medium">${f}</span>
                    </div>
                    <i class="fas fa-chevron-right text-gray-500 text-sm"></i>
                </div>
            `).join('');
        }

        function showAllFeatures() {
            if (!isPro) { showProStatus(); return; }
            pageHistory.push('home');
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById('allFeaturesPage').classList.add('active');
            document.getElementById('backBtn').classList.remove('hidden');
            updateHeader('All Features', '174+ Premium Tools');
        }

        // Initialize gut bacteria when page shown
        setInterval(() => {
            if (document.getElementById('gutPage')?.classList.contains('active')) {
                initBacteria();
            }
        }, 5000);
    </script>
</body>
</html>
